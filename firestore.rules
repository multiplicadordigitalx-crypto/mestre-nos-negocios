rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // --- ADMINISTRATIVE COLLECTIONS (STRICT ADMIN ONLY) ---
    match /payment_gateways/{gateway} { allow read, write: if request.auth.token.admin == true; }
    match /lucpay_configs/{config} { allow read, write: if request.auth.token.admin == true; }
    match /whatsapp_instances/{instance} { allow read, write: if request.auth.token.admin == true; }
    match /domain_providers/{provider} { allow read, write: if request.auth.token.admin == true; }
    match /webhooks/{webhook} { allow read, write: if request.auth.token.admin == true; }
    match /smtp_configs/{config} { allow read, write: if request.auth.token.admin == true; }
    match /ai_configs/{ai} { allow read, write: if request.auth.token.admin == true; }
    match /traffic_accounts/{account} { allow read, write: if request.auth.token.admin == true; }
    match /social_apis/{api} { allow read, write: if request.auth.token.admin == true; }
    
    // --- USER PROFILE SECURITY ---
    match /users/{userId} {
      allow read, write: if request.auth != null && (request.auth.uid == userId || request.auth.token.admin == true);
    }

    // --- DEFAULT DENY (SECURITY BEST PRACTICE) ---
    match /{document=**} {
      allow read, write: if false; 
    }
  }
}

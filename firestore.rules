rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Allow admin collections to be read/written by anyone for now (Development/Setup phase)
    // In production, we should restrict this to authenticated admins
    // Integrações do Sistema (WhatsApp, Pagamentos, Domínios, etc)
    match /payment_gateways/{gateway} { allow read, write: if request.auth != null; }
    match /lucpay_configs/{config} { allow read, write: if request.auth != null; }
    match /whatsapp_instances/{instance} { allow read, write: if request.auth != null; }
    match /domain_providers/{provider} { allow read, write: if request.auth != null; }
    match /webhooks/{webhook} { allow read, write: if request.auth != null; }
    match /smtp_configs/{config} { allow read, write: if request.auth != null; }
    match /ai_configs/{ai} { allow read, write: if request.auth != null; }
    match /traffic_accounts/{account} { allow read, write: if request.auth != null; }
    match /social_apis/{api} { allow read, write: if request.auth != null; }
    
    // Perfis de Usuários
    match /users/{userId} {
      allow read, write: if request.auth != null && (request.auth.uid == userId || request.auth.token.admin == true);
    }

    // Regras Específicas para Gateways (Apenas Admins Reais)
    match /payment_gateways/{gateway} { allow read, write: if request.auth.token.admin == true; }
    match /lucpay_configs/{config} { allow read, write: if request.auth.token.admin == true; }

    // Default rules for other collections
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}
